{% extends "base.html" %}
  
{% block mycontent %}
<link rel="stylesheet" href="{{ url_for('static',filename='css/hotel-search.css') }}" type="text/css">

<div class="container">
    <h1>There are currently {{ hotel_data.meta.count }} hotels available
        in the {{ hotel_data.meta.cityCode }} area</h1>
    <!-- Debugging -->
    <p>Number of booked hotels: {{ num_booked_hotels }}</p>
    <p>Check In: {{ checkIn }}</p>
    <p>Check Out: {{ checkOut }}</p>
    <p>Check In Datetime: {{ checkIn_datetime }}</p>
    <p>Check Out Datetime: {{ checkOut_datetime }}</p>
    <p>Guests: {{ guests }}</p>
    <p>Rooms: {{ rooms }}</p>
    <div class="search-container">
        <div class="location-box">
            <label>Location</label>
            <input type="text" name="location" placeholder="Enter a location">
          </div>
          
          <div class="check-in-out-box">
            <label>Check in / Check out</label>
            <input type="date" name="check_in" placeholder="Check in date">
            <input type="date" name="check_out" placeholder="Check out date">
          </div>
          
          <div class="guests-box">
            <label>Guests</label>
            <input type="number" name="guests" placeholder="Number of guests">
          </div>
          <div class="hotel-availability">
            <label>Show unavailable hotels</label>
            <input type="checkbox" id="switch" /><labels for="switch"></labels>
          </div>
    </div>
</div>

<div class="hotel-cards">
    {% set ns = namespace(hotels_not_available = 0) %}
    {% set ns_availability = namespace(is_available = True) %}
    {% for hotel in hotel_data.data %}
        <!-- Loop through all bookings -->
        {% for booking in booked_hotels %}
            {% if hotel.name == booking.hotelName %}
                {% set booking_checkIn = booking.start_date %}
                {% set booking_checkOut = booking.end_date %}
                <!-- Check if hotel is available during inputted time --> 
                {% if booking_checkIn <= checkOut_datetime or booking_checkOut >= checkIn_datetime %}
                    {% set ns_availability.is_available = False %}
                    {% set ns.hotels_not_available = ns.hotels_not_available + 1 %}
                    <p>{{ hotel.name }} is currently unavailable for your desired booking period.</p>
                {% endif %}
            {% endif %}
        {% endfor %}
        <!-- If available display hotel card -->
        {% if ns_availability.is_available %}
            <a href="/hotel-view/{{ hotel.hotelId }}">
            <a href="/hotel-view/{{ hotel.hotelId }}?checkIn={{ checkIn }}&checkOut={{ checkOut }}&guests={{ guests }}&rooms={{ rooms }}">
                <div class="hotel-card">
                    <div class="hotel-card-image"></div>
                    <div class="hotel-card-details">
                    <h3 class="hotel-card-name">{{ hotel.name }}</h3>
                    <p class="hotel-card-location">{{ hotel.address.countryCode }}</p>
                    <p class="hotel-card-distance">Distance: {{ hotel.distance.value }} {{ hotel.distance.unit }}</p>
                    </div>
                </div>
            </a>
        {% endif %}
        {% set ns_availability.is_available = True %}
    {% endfor %}
    <p>Hotels not available: {{ ns.hotels_not_available }}</p>
    <div class="book-now-modal">
        <div class="modal-content">
            <span id="closeModalBtn" class="close">&times;</span>
            <h5>Your payment options:</h5>
            <div class="modal-options">
                <div>
                    <h6>Pay Now</h6>
                    <ul>
                        <li>We will process your payment in your local currency</li>
                        <li>More ways to pay: use Debit/Credit card</li>
                    </ul>
                    <button id="payNowBtn" onclick="goToCheckout(this)">Pay Now</button>
                </div>
                <div>
                    <h6>Pay when you stay</h6>
                    <ul>
                        <li>You will not be charged until your stay</li>
                        <li> Pay the property directly in their preferred currency</li>
                    </ul>
                    <button id="payLaterBtn" onclick="goToCheckout(this)">Pay when you stay</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    var modal = document.querySelector('.book-now-modal');
    var closeModalBtn = document.getElementById('closeModalBtn');

    // Function to open the modal
    function openModal() {
        modal.style.display = 'block';
    }

    // Function to close the modal
    function closeModal() {
        modal.style.display = 'none';
    }

    // Attach click event to all 'Book Now' buttons
    var bookNowButtons = document.querySelectorAll('.hotel-card-book-now-button');
    // Assuming each hotel card has a data attribute 'data-hotel-id'
    bookNowButtons.forEach(function(button) {
    button.addEventListener('click', function() {
        var hotelId = this.dataset.hotelId;
        var payNowBtn = document.getElementById('payNowBtn');
        var payLaterBtn = document.getElementById('payLaterBtn');
        payNowBtn.dataset.hotelId = hotelId;
        payLaterBtn.dataset.hotelId = hotelId;
        openModal();
    });
});


    // Close the modal when the close button is clicked
    closeModalBtn.addEventListener('click', closeModal);

    // Close the modal if the user clicks outside of it
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            closeModal();
        }
    });
});

function goToCheckout(checkoutType) {
    var hotelId = document.getElementById('payNowBtn').dataset.hotelId; // Both buttons have the same hotel ID
    if (hotelId) {
        var checkoutUrl = '/checkout/' + checkoutType + '/' + hotelId;
        window.location.href = checkoutUrl;
    } else {
        console.error('Hotel ID is not set');
    }
}


</script>

<!--<div class="hotel-card">
  <div class="hotel-card-image"></div>
  <div class="hotel-card-details">
    <h3 class="hotel-card-name">Sonesta Select San Jose Airport</h3>
    <p class="hotel-card-location">San Jose, CA</p>
    <p class="hotel-card-price">$122</p>
    <button class="hotel-card-book-now-button">Book Now</button>
  </div>
</div>-->
<!--<div class="hotel-grid">
    {% for hotel in hotels %}
        <div class="hotel-card">
            <img src="{{ hotel.image_url }}" alt="{{ hotel.name }}" />
            <h2>{{ hotel.name }}</h2>
            <p>Rating: {{ hotel.rating }}</p>
            <p>Location: {{ hotel.location }}</p>
            <p>Price: ${{ hotel.price }}</p>
        </div>
    {% endfor %}
</div>-->

<!-- Footer Section Begin -->
<footer class="footer-section">
            <div class="container">
                <div class="footer-text">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="ft-about">
                                <div class="logo">
                                    <a href="#">
                                        <img src="img/footer-logo.png" alt="">
                                    </a>
                                </div>
                                <p>We inspire and reach millions of travelers<br /> across 90 local websites</p>
                                <div class="fa-social">
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                    <a href="#"><i class="fa fa-tripadvisor"></i></a>
                                    <a href="#"><i class="fa fa-instagram"></i></a>
                                    <a href="#"><i class="fa fa-youtube-play"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 offset-lg-1">
                            <div class="ft-contact">
                                <h6>Contact Us</h6>
                                <ul>
                                    <li>(12) 345 67890</li>
                                    <li>info.colorlib@gmail.com</li>
                                    <li>856 Cordia Extension Apt. 356, Lake, United State</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 offset-lg-1">
                            <div class="ft-newslatter">
                                <h6>New latest</h6>
                                <p>Get the latest updates and offers.</p>
                                <form action="#" class="fn-form">
                                    <input type="text" placeholder="Email">
                                    <button type="submit"><i class="fa fa-send"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright-option">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-7">
                            <ul>
                                <li><a href="#">Contact</a></li>
                                <li><a href="#">Terms of use</a></li>
                                <li><a href="#">Privacy</a></li>
                                <li><a href="#">Environmental Policy</a></li>
                            </ul>
                        </div>
                        <div class="col-lg-5">
                            <div class="co-text"><p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
      Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
      <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p></div>
                        </div>
                    </div>
                </div>
            </div>
</footer>

{% endblock %}

